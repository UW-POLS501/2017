---
title: "POLS 501: Assignment 2"
date: January 18, 2017
---

Submit two files: (1) your R script, and (2) a concise write-up where you report your results. The write-up should be submitted as a PDF file. You may use any program you wish (Word, LaTeX, etc.) to create the write-up, but only submit a PDF.


# Tidy and Relational Data with World Development Indicators 

**NOTE: Don't work on this yet, I'm (jrnold) am going to fill in the details of most of it. **

This is practical example of using R to clean and tidy the World Bank [World Development Indicators](http://data.worldbank.org/data-catalog/world-development-indicators) data

   The primary World Bank collection of development indicators, compiled from officially-recognized international sources. It presents the most current and accurate global development data available, and includes national, regional and global estimates.[^1]

[^1]: http://data.worldbank.org/data-catalog/world-development-indicators

```{r message=FALSE}
library("tidyverse")
library("stringr")
```

We first need to download the WDI data.
This could be done manually  by downloading the file and unzipping it, but these steps can also be automated with R functions.

Create a data directory if it does not already exist, and download the zip file if it does not already exists.
```{r}
# URL of the zip file
wdi_url <- "http://databank.worldbank.org/data/download/WDI_csv.zip"
# location to save data
dst_dir <- "data"
# create a directory
# showWarnings to be silent if already exists, and recursive
# to create subdirs
dir.create(dst_dir, showWarnings = FALSE, recursive = TRUE)
dst_file <- file.path(dst_dir, "WDI_csv.zip")
# directory to unzip the contents of WDI_csv into
wdi_dir <- file.path(dst_dir, "WDI")

```
Now download the zip file, and unzip it into `data/WDI`.

**WARNING: this will take a few minutes since it is a large file**
But because it takes so long, only download it once.
Unzip it to `data/WDI` using the function `unzip()`.
```{r}
if (!file.exists(dst_file)) {
  download.file(wdi_url, dst_file)
  unzip(dst_file, exdir = wdi_dir)
}
```

Let's see what files were included in the zip file
```{r}
dir("data/WDI")
```
The `dir` function lists the files in a directory.

## Importing and tidying data

1. What files are included in the zip file and what do they seem to correspond to.

2. Load the country-level CSV file. Print out the full names of the countries. What's wrong with them Use the `readr::guess_encoding` function to find the probable encoding, adjust the `locale` to be able to load the data in the correct format.

3. If you save the csv file using `readr::write_csv` what encoding will it be in? (Fun fact: if you use Excel on Macs it will always read and write CSV files using the Windows-1252 encoding, which can be problematic, so if you edit the csv file using Excel you can have problems reading it back into R.)

3. Load the country-year file. Check the encoding before loading, and use the same locale as above.

4. Is this tidy data? Why or why not? Why do you think they organized the data this way?

4. Create a tidy dataset in which the rows correspond to (country, year) tuples, and `country`, `year`, and all the indicators are columns.

5. Merge the country-year data with the country-level data. 
   
6. The WDI data include "country" observations that are actually aggregations of countries, for example, "OECD members", "High income", "Sub-Saharan Africa (all income levels)". Filter out those observations. Hint: there is a variable that is missing for non-countries, so you shouldn't need to enumerate all of the non-country values.

7. Choose a few variables you are interested. 


    - Summarize the distributions of these variables by year and income group: mean, median, min, max, standard deviation, 25th percentile, 75th percentile. Accomplish by first using `gather` to create a data frame with columns: `country`, `year`, `indicator`, and `value`. Then you can use `group_by()` and `summarize()` to summarize the data.
    
    - Accomplish the same task using `mutate_at` without using `gather`
    
    - Create a line plot in which the x-axis is years, the y-axis is the mean of the indicator, each income group has its own line and a different color, and faceted by indicator. Merge the indicator level dataset in order to give the indicators meaningful labels in the plot.
      

<!--
### HDI

Calculate the Human Development Indicator. The definition can be found here: http://hdr.undp.org/sites/default/files/hdr2015_technical_notes.pdf.
Check your work against example data in the documentation.
Check your work against the true values of the [Human Development Index](http://hdr.undp.org/en/data):
-->

## Transparency and Missing Values

Hollyer et al. (2011) calculates a measure of governmental transparency using the number of missing values in the WDI.[^hollyer]
We'll calculate something similar.

1. For each country-year calculate a similar figure. Calculate a similar index of missingness. Consider the following: would you use all variables? If not, how would you select those variables? Would you calculate missing values in all variables and all time periods equally?

2. Which countries are least transparent?

3. How do transparency relate to income?

4. Subset by income and plot.

5. Recently the UN released a variable on the "Overall measure of statistical capacity". How does the (original) HRV transparency relate to that measure?
       
[^1]: See the [HRV Transparency Project](http://0001c70.wcomhost.com/wp2/papers/) for more recent  information on it; a 2014 paper of theirs in *Political Analysis* provides a more rigorous measure. 


## Joining WDI to VDEM data

The Varieties of Democracy project is a recent project to develop indicators of democracy.  We would like to merge it with the WDI indicators. Download [Version 6.2](https://www.v-dem.net/en/data/data-version-6-2/) County-Year dataset.

1. What are the terms of using the data? (Why doesn't this document include a script to automatically download it?) How do you cite the data?

2. What are the primary VDEM indices? Subset the data to include only those indices and country and year identifiers.

3. Merge the VDEM and WDI data. What does VDEM use as its country-level indicator? What does the WDI use? Note: The **countrycode** package may be useful here.

4. What is the relationship between democracy and transparency?
   What is the relationship between democracy and transparency comparing only countries within a given income level?

<!--
# Efficacy of Small Class Size in Early Education

*QSS* Exercise 2.8.1
-->

# Success of Leader Assassination as a Natural Experiment

*QSS* Exercise 2.8.3

